{% extends "base.html" %}

{% block title %}
Admin Dashboard
{% endblock %}

{% block content %}
<div class="container mt-4">

    <h1 class="mb-4">Admin Dashboard</h1>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <!-- ===================== -->
    <!-- User Management -->
    <!-- ===================== -->
    <section class="card mb-4">
        <div class="card-header">
            <h5>User Management</h5>
        </div>

        <div class="card-body">
            <form method="post" action="{{ url_for('admin.manage_user_account') }}">

                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="row g-2 align-items-center">

                    <div class="col-md-3">
                        <input type="number" name="user_id" class="form-control" placeholder="User ID" required>
                    </div>

                    <div class="col-md-3">
                        <select name="action" class="form-select" required>
                            <option value="">Select Action</option>
                            <option value="activate">Activate</option>
                            <option value="deactivate">Deactivate</option>
                            <option value="delete">Delete</option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <button type="submit" class="btn btn-primary">
                            Apply Action
                        </button>
                    </div>

                </div>

                <small class="text-muted mt-2 d-block">
                    Enter a User ID and choose an action.
                </small>
            </form>
        </div>
    </section>


    <!-- ===================== -->
    <!-- Reports -->
    <!-- ===================== -->
    <section class="card mb-4">
        <div class="card-header">
            <h5>System Reports</h5>
        </div>
        <div class="card-body">
            <a href="{{ url_for('admin.generate_report', report_type='users') }}"
                class="btn btn-outline-secondary me-2 mb-2">
                Users Report
            </a>
            <a href="{{ url_for('admin.generate_report', report_type='courses') }}"
                class="btn btn-outline-secondary me-2 mb-2">
                Courses Report
            </a>
            <a href="{{ url_for('admin.generate_report', report_type='enrollments') }}"
                class="btn btn-outline-secondary me-2 mb-2">
                Enrollments Report
            </a>
            <a href="{{ url_for('admin.generate_report', report_type='submissions') }}"
                class="btn btn-outline-secondary mb-2">
                Submissions Report
            </a>
        </div>
    </section>

    <!-- ===================== -->
    <!-- System Settings -->
    <!-- ===================== -->
    <section class="card mb-4 shadow-sm">
        <div class="card-header bg-white">
            <h5 class="mb-0"><i class="fas fa-cogs me-2 text-warning"></i>System Settings</h5>
        </div>
        <div class="card-body">
            <p class="text-muted small">Update global site configurations. <strong>Key</strong> is the setting name, and
                <strong>Value</strong> is the data.
            </p>
            <form method="post" action="{{ url_for('admin.configure_system_setting') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="row g-2 align-items-center">
                    <div class="col-md-4">
                        <label class="small fw-bold">Setting Key</label>
                        <input type="text" name="key" class="form-control" placeholder="e.g. app_name" required>
                    </div>
                    <div class="col-md-4">
                        <label class="small fw-bold">Setting Value</label>
                        <input type="text" name="value" class="form-control" placeholder="e.g. My Lab" required>
                    </div>
                    <div class="col-md-4 pt-4">
                        <button type="submit" class="btn btn-warning w-100 fw-bold">
                            Update Setting
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </section>

    <!-- ===================== -->
    <!-- Database Export -->
    <!-- ===================== -->
    <section class="card mb-4">
        <div class="card-header">
            <h5>Database Maintenance</h5>
        </div>
        <div class="card-body">
            <form method="post" action="{{ url_for('admin.export_db_dump') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="row g-2">
                    <div class="col-md-6">
                        <input type="text" name="output_path" class="form-control"
                            placeholder="backups/db_backup.sqlite" required>
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-danger">
                            Export Database
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </section>

</div>
{% endblock %}